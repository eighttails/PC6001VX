<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html401/loose.dtd">
<html lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=EUC-JP">
<meta name="author" content="AKIKAWA, Hisashi">
<title>PC-6001用互換BASIC変更履歴</title>
<link rev="made" href="mailto:icb49250&#64;nifty.ne.jp">
</head>

<body>
<h1>PC-6001用互換BASIC変更履歴</h1>

<hr>

<h2>2022.5.29</h2>
<p>Ver.0.7.5公開。</p>
<ul>
<li>対応ROM内ルーチンが増えました。(1D52h,1E39h)
<li>1061h(ゲームキー入力ルーチン)でCフラグが変化しないように修正。
<li>割り算の結果が小さい時に暴走するバグを修正。(川俣さん、ありがとうございます)
</ul>
<hr>

<h2>2021.6.4</h2>
<p>Ver.0.7.4公開。</p>
<ul>
<li>宣言せずに配列変数を使うことができなくなっていたバグを修正。(eikhussiineokさん、ありがとうございます)
</ul>

<hr>

<h2>2021.6.1</h2>
<p>Ver.0.7.3公開。</p>
<ul>
<li>PC-6001Aでの動作に対応 (起動メッセージとプリンタ動作)、BASICROM.61を同梱。中身はBASICROM.60と同じです。
<li>BASICROM.62の同梱を終了します。今後は<a href="http://000.la.coocan.jp/p6/basic66.html">PC-6001mkII/6601用互換BASIC</a>を使ってください。一応、BASICROM.60をリネームしてサイズを32KBにすれば、今まで通りmkII上で使うことも可能ですが、この機能は将来的に削除される可能性があります。
<li>iP6/iP6winでの16KB動作に仮対応。
<li>FRE()の表示値を微調整。
<li>対応ROM内ルーチンが増えました。(0BEEh, 272Dh)
<li>同梱のbdf2cgromでの文字割り当てと計算アルゴリズムを一部変更。また、新しいオプションとして-pc6001aと-ascentを追加。
<li>バグを修正。
<ul>
<li>LIST命令のESC状態が、N60-BASICでは無効となるキー入力で解除されることがある (じゃんめろ。さん、ありがとうございます)
<li>0/0がエラーにならない
<li>ファンクションキーの文字列中にCHR$(0)があっても、続く文字が入力されてしまう
<li>CSAVEやPRINT#-1での無音時間が少し短くなっていた (Ver.0.7から)
</ul>
</ul>

<hr>

<h2>2020.11.21</h2>
<p>Ver.0.7.2公開。</p>
<ul>
<li>スクリーンモード1と2のLINE BF命令が正常に動かない場合があるバグを修正。(eikhussiineokさん、ありがとうございます)
</ul>

<hr>

<h2>2020.6.1</h2>
<p>Ver.0.7.1公開。</p>
<ul>
<li>対応ROM内ルーチンが増えました。(1CD2h,1CF6h,1D73h,2701h)
<li>プログラム入力時の中間言語変換が少し速くなったはず。
<li>バグを修正。
<ul>
<li>スクリーンエディタ使用中に行頭でDELを押しても字が消えない
<li>CLEARの第二パラメータで非常に小さいアドレスを指定すると誤動作を起こす
<li>DIM命令で配列でない通常変数を複数指定するとエラーになる
<li>同梱のbdf2cgromで変換に失敗する可能性がある
<li>プログラム入力時にオーバーメモリエラーチェックをしていない
<li>LPRINT後のINPUTでプロンプトが正常に表示されない
</ul>
</ul>

<hr>

<h2>2019.9.1</h2>
<p>Ver.0.7公開。</p>
<ul>
<li>LGPLv2.1以降での利用を可能としました。
<li>対応ROM内ルーチンが増えました。(1179h,1181h,14AFh,1A1Ch,1B2Ah)
<li>等号不等号3種を1種ずつ3個並べた演算子 (>=<, <=>, ><=, <>=, =><, =<>) に対応。常に真となる比較演算を行います。
<li>EXEC命令で0以外のアドレスを指定した時にCフラグを立てるよう修正。
<li>文字列演算時に?OS Errorや?ST Errorが出やすい問題を改善。
<li>バグを修正。
<ul>
<li>スクリーンモードが3か4の時、カーソルが行頭以外にある状態でプログラムが終わっても改行しない
<li>同梱のbdf2cgromがFONT_DESCENT 0の時に動かない
<li>マイナス符号と小数点が両方ある数値に対してVAL()が正しく動作しない
<li>マイナス符号と小数点が両方ある数値に対してREAD-DATAが正しく動作しない
<li>INPUT命令での複数入力に失敗する
<li>INPUT命令での入力に対しDELキーを使うと入力が欠けることがある
<li>文字列演算の途中でガベージコレクションが発生すると結果が壊れることがある
</ul>
</ul>

<hr>

<h2>2018.1.30</h2>
<p>Ver.0.6.4公開。</p>
<ul>
<li>対応ROM内ルーチンが増えました。(0384h,038Bh,1B2Ah)
<li>バグを修正。
<ul>
<li>SCREEN()が正常に動作しない
<li>COS()の引数が減算を含む式だった場合にエラーになる (0.6.3で直したつもりが直っていなかった)
<li>等号の演算順序が不等号より先になっていた (N60-BASICでは同順位)
<li>実機で拡張RAM無しの場合に起動に失敗する
</ul>
</ul>

<hr>

<h2>2017.9.1</h2>
<p>Ver.0.6.3公開。</p>
<ul>
<li>バグを修正。
<ul>
<li>カーソルキーを3個以上同時に押した時のSTICK()の値が異なる
<li>DIM命令で配列変数でなく通常変数を指定した時に、続く命令が正常に実行されない
<li>LEFT$(),RIGHT$(),MID$()においてグラフィック文字の途中で分割した時の結果が異なる
<li><del>COS()の引数が減算を含む式だった場合エラーになることがある</del>
</ul>
</ul>

<hr>

<h2>2017.7.13</h2>
<p>Ver.0.6.2公開。</p>
<ul>
<li>CLOAD時のアスタリスク点滅タイミングをN60-BASICと同様に変更。(Tsutsuiさん、ありがとうございます)
<li>バグを修正。
<ul>
<li>PLAY文の音程データが不正確だった (bookwormさん、ありがとうございます)
<li>同じFORループを途中で抜けるのを繰り返すとやがて?OM Errorになる
<li>?OM Errorの際にプログラムが破壊されることがある
<li>特定の条件下でNEXTやRETURNが誤動作する
<li>PLAY"M0"がエラーにならない
<li>整数値を扱う命令で負数も有効になるもの (AND、PEEK、CLEARなど) の場合、小数点付きの負数を使った時の端数処理が正しくない
<li>RND()の値がおかしい場合がある
<li>累乗計算で指数が大きい時の結果がおかしい
<li>VAL関数で指数部を含む文字列を指定すると、別の文字列まで読んでしまうことがある
<li>多重ループのNEXT命令がコンマで終わった時にエラーにならない
</ul>
</ul>

<hr>

<h2>2017.2.17</h2>
<p>Ver.0.6.1公開。</p>
<ul>
<li>PLAY文の音長精度が少しだけ良くなったはず。
<li>対応ROM内ルーチンが増えました。(1AEDh, 1B49h, 1B4Bh)
<li>CONSOLE文実行直後にファンクションキー表示の有無が変わらないことがあるバグを修正。(Tsutsuiさん、ありがとうございます)
</ul>

<hr>

<h2>2016.12.29</h2>
<p>Ver.0.6公開。</p>
<ul>
<li>実数演算や数学関数の精度が少し良くなったはず。
<li>対応ROM内ルーチンが増えました。(0DE3h)
<li>バグを修正。
<ul>
<li>音楽演奏中のジョイスティック読み出しとSOUND文が誤動作する可能性がある
<li>CONSOLE命令でスクロール範囲を1行だけにした場合、直前の行との接続状態が保たれたままなので、復帰できないことがある
<li>CONSOLE命令でエラーになる時や非常に大きな値を入力したときの挙動が異なる
<li>INP関数とCHR$関数で、引数が数値かどうかのチェックをしていない
<li>VAL関数で空白や小数点や指数部を含む文字列を指定すると、別の文字列まで読んでしまうことがある
<li>EXP関数で正しくない結果を返す場合がある (EXP(45337)〜EXP(45426)あたり)
<li>指数表現の仮数部が0だとエラーになる (0e1など)
<li>累乗計算で、底がゼロや負数だとエラーになる
<li>差が非常に大きい数を引き算すると答えがおかしい
<li>答えが非常に小さくなる足し算や掛け算を行うとエラーになる
</ul>
</ul>

<hr>

<h2>2016.1.29</h2>
<p>Ver.0.5.1公開。</p>
<ul>
<li>対応ROM内ルーチンが増えました。(2739h, 30CEh, 310Fh, 3AA5h, 3AACh)
<li>バグを修正。
<ul>
<li>グラフィック文字を実行させようとすると暴走する
<li>プログラム中のグラフィック文字が正しく入力できない
<li>REM文、DATA文中の仮名文字がLISTで正しく表示されない
<li>SCREEN命令で画面モードを変更する時、第3パラメータで別のページを指してもモード変更の過程が一瞬見えてしまう
<li>PRINT文で数字を表示する時、桁数が多いと途中で改行されてしまう (N60-BASICではあらかじめ改行してから表示してくれる)
<li>PRINT文でスクリーンモード3でコンマを使った時の動作が違う
</ul>
</ul>

<hr>

<h2>2015.12.7</h2>
<p>Ver.0.5公開。</p>
<ul>
<li>同梱のbdf2cgromを、縦横比1:1以外のフォントにも対応するよう変更。横幅はFONTBOUNDINGBOXを参照します。
<li>コマンド呼び出し時のレジスタなどをN60-BASICと同様に変更。
<li>以下の命令についてN60-BASICと同じアドレスに変更。RUN(0781h), DATA(07E0h), REM(07E2h), LPRINT(087Ah), PRINT(087Eh), COLOR(1D9Bh), SCREEN(1E04h)
<li>対応ROM内ルーチンが増えました。(0028h, 0390h, 0442h, 0781h, 07E0h, 07E2h, 087Ah, 087Eh, 10AAh, 1257h, 1A4Fh, 1BBEh, 1D9Bh, 1E04h, 274Dh, 2539h, 25A8h, 28F9h, 3BAFh)
<li>バグを修正。
<ul>
<li>スクリーンモード2でテキストのある位置にLINEやPSETでカラーコード0のドットを置いた時の挙動が異なる
<li>高速でキー入力したり、エミュレータのテキストペースト機能を使うと、取りこぼしが発生する
<li>INPUT文実行中やコマンド入力時にCtrl-Cが効かない
<li>PRINT/LPRINT文によるプリンタへの出力でTAB()を使った時に、直後の1文字が無視される
<li>PAINT文で異常にスタックを消費する場合がある
<li>キーバッファがいっぱいだとESCが効かない
<li>DIM文で256以上の数字を指定するとエラーになる
<li>DATA文を入力する時、""で囲んだ文字列の後がおかしくなる
<li>DIM Aとした時に配列変数A(10)が生成される (N60-BASICでは通常変数Aが生成される)
<li>プログラム入力時に先頭にスペースを挟むとエラーになる
<li>PLAY中にキークリック音が鳴ると音が消える
<li>STOP-CONTの動作が色々おかしい
<li>プログラム中にグラフィック文字を直接置くと、うまく入力されない
<li>PRINT#-2でSPC()かTAB()か,を使った時に正しく出力されない
<li>CONSOLE,0とすると変になる
</ul>
</ul>

<hr>

<h2>2014.12.3</h2>
<p>Ver.0.4公開。</p>
<ul>
<li>mkIIの起動に対応。BASICROM.62をモード2相当の起動ROMとして使えます。ファイル名とサイズは違いますが中身はBASICROM.60と同じです。初代機画面モードかつ裏RAM使用といった類のmkII以降用プログラムを動かせるのではないかと思います。
<li>EXECやUSRの後ろに引数を追加して独自解析するようなプログラムに、ある程度対応。
<li>対応ROM内ルーチンが増えました。(0008h, 0018h, 0038h, 0DE4h, 0E78h, 0E8Fh, 0EB0h, 0EB5, 0FC4h, 1478h, 1BCDh, 2030h, 204Bh, 25E5h, 2D13h, 2D47h, 2DE4h, 2E1Fh, 2E35h, 2EFAh, <del>397Ah,</del> 3AA1h)
<li>バグを修正。
<ul>
<li>一つのDIM文で複数の配列を定義する時、変数-コンマ間にスペースがあるとエラーになる (eighttailsさん、ありがとうございます)
<li>一つのINPUT文で複数のデータを入力させる時、文字列変数-コンマ間にスペースがあるとエラーになる
<li>INPUT文で文字列をコンマで区切って入力した時、コンマの後ろのスペースが有効になってしまう
<li>INPUT文で、入力行に最初から文字があった場合の挙動が異なる
<li>LIST文で65531〜65535行も表示できる (N60-BASICでは65530行まで)
<li>DATA文中や""中に小さい「ょ」があると、LISTを実行した時にREMと表示される
<li>データが無かったりコンマで終わったりしているDATA文を数値変数でREADした時に正しく読めない (N60-BASICでは0があると見なされる)
<li>PLAY文でチャンネルごとの演奏長さが違う場合、うまく揃わず演奏が長時間止まるケースがある
<li>PLAY文中の=で配列変数が使えない
<li>CSAVE文で、ファイルネーム部分とプログラム部分の間のショートヘッダ(0.5秒間のピー音)が出力されない
<li>環境によってはCSAVE中のSTOPが正常に動作しない
<li>PAINT文で境界色を省略した時の挙動が異なる
<li>CONSOLE0,1,1としてスクリーンモードを変えると表示が変になる
<li>スクリーンモード3または4でのCLS文及び1DFBhコールで、アトリビュートもクリアしてしまう
<li>エミュレータによってはRESTORE無しのREAD文がエラーになる
<li>RND()が返す最小の数がN60-BASICより大きい
<li>ガベージコレクションが起きた時の文字列領域解放が不完全
<li>CHR$(&amp;H14)出力の直後に改行が行われる場合の挙動が異なる場合がある
<li>「1(2)」のような表現があると2と解釈される
<li>DELを押した時に、行末の字が残る
<li>スクリーンモード2でCtrl-U/Ctrl-Eを押した時に、同行内のセミグラフィック部分が正しく消去されない
<li>キーバッファがいっぱいだとCtrl-CでSTOPがかからない
</ul>
</ul>

<hr>

<h2>2014.5.21</h2>
<p>Ver.0.3.3公開。</p>
<ul>
<li>MID$の第3パラメータが省略された時に暴走する不具合を修正。(MORIYAさん、ありがとうございます)
</ul>

<hr>

<h2>2014.5.20</h2>
<p>Ver.0.3.2公開。</p>
<ul>
<li>グラフィック文字が入力できるように見えて実はできない不具合を修正。
<li>PLAY文のNコマンドが正しく動かない不具合を修正。
<li>LETコマンドが使えない不具合を修正。
</ul>

<hr>

<h2>2014.5.19</h2>
<p>Ver.0.3.1公開。</p>
<ul>
<li>グラフィック文字が入力できない不具合を修正。
</ul>

<hr>

<h2>2014.5.18</h2>
<p>Ver.0.3公開。</p>
<ul>
<li>スクリーンエディタ実装。
<li>対応ROM内ルーチンが増えました。(0010h, 11B8h, 11DAh, 1260h, 12A9h, 1DBBh, 2576h, 2583h, 26C7h)
<li>同梱のbdf2cgromに-asciiオプションを追加。
<li>バグを修正。
<ul>
<li>PAGEキーでグラフィック画面を表示している時にSTOPキーを押してもテキスト画面に戻らない
<li>P6T形式のファイルでオートスタートが効かない場合がある
<li>プロンプトを表示するINPUT文で?Redo from startになると入力後エラーになる
<li>INPUT文で入力した文字列の頭とお尻のスペースがカットされない
<li>ファンクションキーをセットした時、後ろにゴミが付く場合がある
<li>何かの値の後にすぐ続けて関数があると、前の値が無視される
<li>CONSOLE範囲外でのPRINT CHR$(&amp;H1E);及びPRINT CHR$(&amp;H1F);の挙動が違う (Ver.0.2で直したつもりが不完全だった)
<li>行番号、How Many Pages?、PLAY文のMパラメータで、65536〜65539が0〜3とみなされる
<li>CONTした時、元のページに戻らない
<li>PRINT CHR$(10);で行頭に戻ってしまう
<li>CONSOLE実行直後にスクロール範囲より下でもカーソル位置がそのまま
<li>キー入力ルーチン (0FBCh, 103Ah) でSTOPやESCが取得できない
<li>KEY 0,"..."がエラーにならない
<li>CONTに対する動作がいろいろおかしい場合がある
<li>PRINT SPC(0)で空白が256個出力される
<li>スクリーンモード3または4でスクロール範囲を1行にしてスクロールさせるとおかしくなる
<li>SQR()の結果が間違っている
<li>テキスト画面のLCOPYがおかしい
<li>たまにカーソル表示が画面に残る
<li>PRINT/INPUTで#の後のデバイス番号判定が不完全
<li>スクリーンモード3のPRINTでコンマを使った時の表示位置が間違っている
<li>サイズの異なる文字列同士の比較が正しくない場合がある
<li>文字列と数字の大小比較がエラーにならない
<li>PAINTの塗り方が正しくない (fuzzballさん、ありがとうございます)
<li>CLOADで実際より短いファイル名を指定した時にもFoundになる
<li>DIM A(-1)などとすると暴走する
<li>END文のたびにスタックを消費する
<li>IF...GOTOの後が数字でなくコマンドだった場合にエラーになる
<li>DATA...:コマンド と打ち込んだ場合の中間言語変換がおかしい
<li>DATA"...":がREADで読めない
<li>PRINT#-1によるテープ出力で、最後の改行が出力されない
</ul>
</ul>

<hr>

<h2>2014.2.23</h2>
<p>Ver.0.2公開。</p>
<ul>
<li>ダイレクトコマンドモード、プログラム入力機能実装。ただしラインエディタです。
<li>PLAY、LIST、LLISTを実装。これでとりあえず全コマンド実装。
<li>スクリーン3、4のLINE BFが実用的な速度になりました。
<li>エミュレータのパッチ機能が有効のままでも動くようにしました。パッチされるアドレスは使用せず。(PC6001V/VW/VX=1CB4h-1CB5h iP6plus=10EAh)
<li>対応ROM内ルーチンが増えました。(0020h, 0F74h, 116Dh, 14A0h, 1B60h, 1BB3h, 1BC5h, 1CA6h, 1DFBh, 1EB3h, 254Eh)
<li>エラーの判定条件がN60-BASICに少し近付きました。
<li>バグを修正。
<ul>
<li>How Many Pages?時やINPUT文でキー入力が変な時がある (Hashiさん、ありがとうございます)
<li>BASICの後ろにマシン語データが付加されている場合、変数を使用するとデータが破壊される (MORIYAさん、ありがとうございます)
<li>PC6001VWでINPUT文が正常に動かないことがある
<li>KEY文で空文字列がセットできない
<li>スクリーンモード2のCOLOR文の挙動が少し違う
<li>CONSOLE範囲外でのPRINT CHR$(&amp;H1E)及びPRINT CHR$(&amp;H1F)の挙動が違う
<li>LOG(X)が0&lt;X&lt;=1でおかしい
<li>10 RUNのようなプログラムを実行すると、スタックを食い潰した末にプログラムを破壊してしまう
<li>How Many Pages?でスペースを先頭に入れるとエラーになる
<li>GOTOなどで65530〜65535行を指定できてしまう
<li>LPOS()の括弧内が数値や文字列以外でもエラーにならない
<li>LOCATEで範囲外を指定した時の挙動がおかしい場合がある
<li>STICK()とSTRIG()で引数範囲の判定がおかしい
<li>関数の左括弧の前にスペースが入るとエラーになってしまう
<li>-65535が1と同じ扱いになるべきでない命令で同じになっている
<li>1ページ目をスクリーンモード3や4にできてしまう
<li>PAINTの塗り方が正しくない
</ul>
</ul>

<hr>

<h2>2014.1.12</h2>
<p>Ver.0.1公開。</p>
<ul>
<li>ダイレクトコマンドモードとプログラム入力機能無し
<li>テープ起動のみ (勝手にCLOAD+RUN実行)
<li>PLAY,LIST,LLIST未実装
</ul>

<hr>

</body>
</html>
