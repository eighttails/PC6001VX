<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html401/loose.dtd">
<html lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=EUC-JP">
<meta name="author" content="AKIKAWA, Hisashi">
<title>PC-6001mkII/6601用互換BASIC変更履歴</title>
<link rev="made" href="mailto:icb49250&#64;nifty.ne.jp">
</head>

<body>
<h1>PC-6001mkII/6601用互換BASIC変更履歴</h1>

<hr>

<h2>2023.1.9</h2>
<p>Ver.0.4.2公開。</p>
<ul>
<li>バグを修正。
<ul>
<li>トラック0セクタ1にデータがあるフロッピーを入れてモード5で起動すると誤動作する
<li>FDDありでモード3か4で起動した時に誤動作する可能性がある (eikhussiineokさん、ありがとうございます)
</ul>
</ul>

<hr>

<h2>2022.12.30</h2>
<p>Ver.0.4.1公開。</p>
<ul>
<li>PLAY文の継ぎ目が少し目立ちにくくなりました。
<li>バグを修正。
<ul>
<li>モード5のスクリーンモード2で文字や線の色に0を指定した時の動作が実機と異なる
<li>モード5のスクリーンモード1と2で背景色に範囲外の値を指定した時の動作が実機と異なる
<li>フロッピー読み込みエラー時に暴走する場合がある
<li>スクリーンモード2〜4でCLOADすると右上の*が正常に表示されない (eikhussiineokさん、ありがとうございます)
<li>CIRCLE命令で、半径=0、アスペクト比≧0の時にエラーになる (eikhussiineokさん、ありがとうございます)
<li>42B9hコールでBCレジスタが破壊される
<li>モード1,2で拡張ROMが見えないバンク状態になっている (eikhussiineokさん、ありがとうございます)
<li>PUT@命令で、表示条件としてORを指定した時に誤動作する
<li>CLOAD*命令で読み込みエラー時に暴走する
<li>ディスク容量に余裕があっても、サイズの大きいファイルへの書き出しで失敗することがある (eikhussiineokさん、ありがとうございます)
<li>DSKO$の書式が間違っている
<li>複数ドライブのファイルをopenしていると、LOC()とLOF()が正常に動作しない
<li>SAVE命令で、プログラムサイズが256バイトの整数倍、かつ奇数番目のクラスタが先頭になると、正常にセーブできない
<li>INPUT文で?が行末に来る位置だと正常に入力できない (eikhussiineokさん、ありがとうございます)
<li>起動後のディスク入れ替えが考慮されていない (eikhussiineokさん、ありがとうございます)
</ul>
</ul>

<hr>

<h2>2022.6.26</h2>
<p>Ver.0.4公開。</p>
<ul>
<li>OPEN、CLOSE、GET、PUT、FIELD、RSET、LSET、DSKO$()、EOF()、LOC()、LOF()、PAD()及び、フロッピーディスクに対するPRINT#、INPUT#、GET@、PUT@を実装。
<li>対応ROM内ルーチンが増えました。(0BEEh,1D52h,1E39h,272Dh,2905h)
<li>ディスクに対するRUN命令に,Rオプションを追加。
<li>LOAD、MERGE、ディスクに対するRUN命令に?OM Errorチェックを追加。
<li>同梱のbdf2cgrom66/bdf2kanjirom/bdf2exkanji/bdf2extkanjiでの文字割り当てと変換アルゴリズムを一部変更。また、新しいオプションとして-ascentを追加。
<li>1061h (ゲームキー入力ルーチン) でCフラグが変化しないように変更。

<li>バグを修正。
<ul>
<li>bdf2exkanjiが動作しない (windyさん、eighttailsさん、ありがとうございます)
<li>bdf2exkanji/bdf2extkanjiで、元フォントのサイズが小さい場合8x16文字と8x8文字が異常に小さくなる
<li>LIST命令のESC状態が、N6X-BASICでは無効となるキー入力で解除されることがある (じゃんめろ。さん、ありがとうございます)
<li>PRINT#-1とPRINT#-2で,を使った時、初代機と同じく空白が出力されてしまう (じゃんめろ。さん、ありがとうございます)
<li>SCREEN2でCLSした時のアトリビュートの値がおかしい (eighttailsさん、ありがとうございます)
<li>NEWの後に不要な文字を加えてもエラーにならない (川俣さん、ありがとうございます)
<li>0/0がエラーにならない
<li>ファンクションキーの文字列中にCHR$(0)があっても、続く文字が入力されてしまう
<li>CSAVEやPRINT#-1での無音時間が少し短くなっていた (Ver.0.2から)
<li>モード5でCOLOR第3パラメータをチェックしていない (Tsutsuiさん、ありがとうございます)
<li>割り算の結果が小さい時に暴走する (川俣さん、ありがとうございます)
<li>MERGE命令使用時に、元々ある行番号と読み込むファイルにある行番号が重なると正常に動作しない (eikhussiineokさん、ありがとうございます)
<li>INPUT命令で文字列変数を使用する場合、何も入力しないと、変数が空文字列で上書きされてしまう
<li>RUN命令のファイル名指定に文字列変数を使用できない
<li>GET@、PUT@命令で@が省略できない
<li>負数に対するEXP関数やべき乗で、正しくない結果を返す場合がある (EXP(-89)〜EXP(-177)あたり)
</ul>
</ul>

<hr>

<h2>2020.11.21</h2>
<p>Ver.0.3.1公開。</p>
<ul>
<li>バグを修正。
<ul>
<li>ファイル名を指定してのRUN命令が動作しない
<li>MERGE命令の後ろに,Rをつけるとプログラムを実行してしまう
<li>スクリーンモード1と2のLINE BF命令が正常に動かない場合がある (eikhussiineokさん、ありがとうございます)
<li>SCREEN関数で各行左端の文字しか読めない (eikhussiineokさん、ありがとうございます)
</ul>
</ul>

<hr>

<h2>2020.6.6</h2>
<p>Ver.0.3公開。</p>
<ul>
<li>「PC-6601用」だとmkIIで使えないような誤解を招きそうな気がしたので名称を変更。BASICROM.62/VOICEROM.62も同梱するように。(中身はBASICROM.66/VOICEROM.66と同じもの)
<li>LOAD、SAVE、BLOAD、BSAVE、FILES、LFILES、KILL、NAME、MERGE、DSKF()、DSKI$()、CVS()、MKS$()を実装。
<li>外付けFDDに対応。
<li>FAT8標準フォーマットのブランク1Dファイル (D88形式、40トラック) を同梱。
<li>対応ROM内ルーチンが増えました。(2701h,51F2h,5CFDh)
<li>プログラム入力時の中間言語変換が少し速くなったはず。
<li>PC6001VWのTALK字幕機能に仮対応。
<li>バグを修正。
<ul>
<li>TALK命令で固定語を連続して喋らせると後の方しか発声しない (Ackieeeさん、ありがとうございます)
<li>DIM命令で配列でない通常変数を複数指定するとエラーになる
<li>プログラム入力時にオーバーメモリエラーチェックをしていない
<li>LPRINT後のINPUTでプロンプトが正常に表示されない
</ul>
</ul>

<hr>

<h2>2019.10.3</h2>
<p>Ver.0.2.2公開。</p>
<ul>
<li>HEX$()が正常に動かない不具合を修正。
</ul>

<hr>

<h2>2019.9.19</h2>
<p>Ver.0.2.1公開。</p>
<ul>
<li>対応ROM内ルーチンが増えました。(1CD2h,1CF6h,1D73h,6B4Ah,6B9Bh,7161h)
<li>拡張漢字ROMイメージ変換プログラムをbdf2extkanjiとbdf2exkanjiの2種類に変更。
<li>バグを修正。
<ul>
<li>同梱のbdf2cgrom66で出力されるCGROM60.66が縦10ドットフォントになっている (eighttailsさん、ありがとうございます)
<li>同梱のbdf2cgrom66.exe、bdf2extkanji.exeで変換に失敗する可能性がある
<li>スクリーンエディタ使用中に行頭でDELを押しても字が消えない
<li>CLEARの第二パラメータで非常に小さいアドレスを指定すると誤動作を起こす
</ul>
</ul>

<hr>

<h2>2019.9.9</h2>
<p>Ver.0.2公開。</p>
<ul>
<li>LGPLv2.1以降での利用を可能としました。
<li>HEX$()、DELETE、CLOAD*、CSAVE*、GET@、PUT@、MON、CIRCLEを実装。
<li>対応ROM内ルーチンが増えました。(0384h,038Bh,1179h,1181h,14AFh,1A1Ch,1B2Ah,3995h)
<li>CLOAD時のアスタリスク点滅タイミングをN60-BASICと同様に変更。(Tsutsuiさん、ありがとうございます)
<li>等号不等号3種を1種ずつ3個並べた演算子 (>=<, <=>, ><=, <>=, =><, =<>) に対応。常に真となる比較演算を行います。
<li>EXEC命令で0以外のアドレスを指定した時にCフラグを立てるよう修正。
<li>拡張漢字ROMイメージ変換プログラムbdf2extkanjiを同梱。
<li>文字列演算時に?OS Errorや?ST Errorが出やすい問題を改善。
<li>mkII/6601用のカートリッジ起動に対応。
<li>バグを修正。
<ul>
<li>PLAY文の音程データが不正確だった (bookwormさん、ありがとうございます)
<li>同じFORループを途中で抜けるのを繰り返すとやがて?OM Errorになる
<li>?OM Errorの際にプログラムが破壊されることがある
<li>特定の条件下でNEXTやRETURNが誤動作する
<li>PLAY"M0"がエラーにならない
<li>整数値を扱う命令で負数も有効になるもの (AND、PEEK、CLEARなど) の場合、小数点付きの負数を使った時の端数処理が正しくない
<li>RND()の値がおかしい場合がある
<li>累乗計算で指数が大きい時の結果がおかしい
<li>VAL関数で指数部を含む文字列を指定すると、別の文字列まで読んでしまうことがある
<li>多重ループのNEXT命令がコンマで終わった時にエラーにならない
<li>スクリーンモード1,2でセミグラフィック文字のある箇所にPSETやLINEでグラフィックを描いた時の挙動が異なる
<li>カーソルキーを3個以上同時に押した時のSTICK()の値が異なる
<li>DIM命令で配列変数でなく通常変数を指定した時に、続く命令が正常に実行されない
<li>LEFT$(),RIGHT$(),MID$()においてグラフィック文字の途中で分割した時の結果が異なる
<li>COS()の引数が減算を含む式だった場合エラーになることがある
<li>等号の演算順序が不等号より先になっていた (N6X-BASICでは同順位)
<li>実機で漢字ROM/音声合成ROMへのバンク切り替えに失敗する
<li>SCREEN()が正常に動作しない
<li>スクリーンモードが3か4の時、カーソルが行頭以外にある状態でプログラムが終わっても改行しない
<li>同梱のbdf2cgrom66がFONT_DESCENT 0の時に動かない
<li>FDDオートスタートからの起動でBASICモードを自動入力できない
<li>モード1-4のスクリーンモード3でカラー5以上の色が異なる
<li>マイナス符号と小数点が両方ある数値に対してVAL()が正しく動作しない
<li>マイナス符号と小数点が両方ある数値に対してREAD-DATAが正しく動作しない
<li>INPUT命令での複数入力に失敗する
<li>INPUT命令での入力に対しDELキーを使うと入力が欠けることがある
<li>ページを変更した時にカラーセット(COLOR命令第3パラメータ)が変化してしまう
<li>6B7Ah(COLOR命令第3パラメータ実行ルーチン)の入力値が間違っている
<li>文字列演算の途中でガベージコレクションが発生すると結果が壊れることがある
</ul>
</ul>

<hr>

<h2>2017.6.6</h2>
<p>Ver.0.1公開。</p>
<ul>
<li>N60-BASICにある命令＋KANJI＋TALKのみ実装済み。
<li>FDDに関しては、最低限のアクセスルーチンとオートスタートを実装。内蔵ドライブのみ。
</ul>
<hr>

</body>
</html>
